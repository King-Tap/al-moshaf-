<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@500;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f4f7f6; }
        .quran-font { font-family: 'Amiri', serif; line-height: 2.5; text-align: justify; font-size: 1.8rem; }
        [v-cloak] { display: none; } /* ÙŠÙ…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
    </style>
</head>
<body>
<div id="app" v-cloak class="flex flex-col h-screen">
    <header class="bg-[#064e3b] text-white p-4 flex justify-between items-center shadow-lg">
        <h1 class="font-bold text-lg">ğŸ“– Ø§Ù„Ù…ØµØ­Ù (Ø¨Ø¯ÙˆÙ† Ù†Øª)</h1>
        <button v-if="!isDownloaded" @click="downloadQuran" :disabled="loading" class="bg-yellow-500 text-black text-[10px] px-3 py-1 rounded-full font-bold">
            {{ loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…ØµØ­Ù' }}
        </button>
    </header>

    <main class="flex-1 overflow-y-auto p-4">
        <div v-if="!isDownloaded && view === 'index'" class="bg-white p-4 rounded-xl shadow mb-4 text-center border-2 border-yellow-400">
            <p class="text-sm mb-2">Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</p>
        </div>

        <div v-if="view === 'index'">
            <input v-model="search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©..." class="w-full p-4 mb-4 rounded-xl border-none shadow-sm outline-none focus:ring-2 focus:ring-emerald-500">
            <div class="grid gap-2">
                <div v-for="s in filteredSurahs" :key="s.number" @click="openSurah(s)" class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-[#064e3b] flex justify-between items-center">
                    <span class="font-bold">{{ s.number }}. {{ s.name }}</span>
                    <span v-if="isDownloaded" class="text-[10px] text-emerald-600">Ø¬Ø§Ù‡Ø² Ø£ÙˆÙÙ„Ø§ÙŠÙ† âœ…</span>
                </div>
            </div>
        </div>

        <div v-if="view === 'reading' && currentSurah" class="bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-3xl font-bold text-center text-emerald-900 mb-6">{{ currentSurah.name }}</h2>
            <div class="quran-font text-gray-800">
                <span v-for="ayah in currentSurah.ayahs" :key="ayah.numberInSurah">
                    {{ ayah.text }} <span class="inline-flex items-center justify-center w-8 h-8 rounded-full border border-emerald-200 text-sm mx-1">{{ ayah.numberInSurah }}</span>
                </span>
            </div>
            <button @click="view = 'index'" class="w-full mt-10 p-4 bg-gray-100 rounded-xl font-bold text-gray-500">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙÙ‡Ø±Ø³</button>
        </div>
    </main>
</div>

<script>
const { createApp, ref, onMounted, computed } = Vue;
createApp({
    setup() {
        const view = ref('index');
        const search = ref('');
        const surahs = ref([]);
        const currentSurah = ref(null);
        const loading = ref(false);
        const isDownloaded = ref(localStorage.getItem('quran_ready') === 'true');

        onMounted(async () => {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            if (isDownloaded.value) {
                try {
                    surahs.value = JSON.parse(localStorage.getItem('quran_content'));
                } catch (e) {
                    isDownloaded.value = false;
                    fetchIndex();
                }
            } else {
                fetchIndex();
            }
        });

        const fetchIndex = async () => {
            try {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await res.json();
                surahs.value = data.data;
            } catch (e) { console.log("Offline mode"); }
        };

        const downloadQuran = async () => {
            loading.value = true;
            try {
                const res = await fetch('https://api.alquran.cloud/v1/quran/quran-uthmani');
                const data = await res.json();
                localStorage.setItem('quran_content', JSON.stringify(data.data.surahs));
                localStorage.setItem('quran_ready', 'true');
                surahs.value = data.data.surahs;
                isDownloaded.value = true;
                alert("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø¯ÙˆÙ† Ù†Øª.");
            } catch (e) { alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„"); }
            loading.value = false;
        };

        const openSurah = (s) => {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙˆØ±Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¢ÙŠØ§Øª (Ø³ÙˆØ§Ø¡ Ù…Ù† Ø§Ù„Ù†Øª Ø£Ùˆ Ø§Ù„Ù…Ø®Ø²Ù†)
            if (isDownloaded.value) {
                currentSurah.value = s;
                view.value = 'reading';
            } else {
                loading.value = true;
                fetch(`https://api.alquran.cloud/v1/surah/${s.number}/quran-uthmani`)
                    .then(res => res.json())
                    .then(data => {
                        currentSurah.value = data.data;
                        view.value = 'reading';
                        loading.value = false;
                    });
            }
            window.scrollTo(0,0);
        };

        const filteredSurahs = computed(() => surahs.value.filter(s => s.name.includes(search.value)));

        return { view, search, surahs, currentSurah, loading, isDownloaded, downloadQuran, openSurah, filteredSurahs };
    }
}).mount('#app');
</script>
</body>
</html>
