<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…ØµØ­Ù Ø§Ù„Ø§Ø³ØªØ°ÙƒØ§Ø± - Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; }
        .quran-font { font-family: 'Amiri', serif; line-height: 2.4; font-size: 1.8rem; text-align: justify; }
        .tab-active { background: #064e3b !important; color: white !important; }
    </style>
</head>
<body>

<div id="app" class="min-h-screen flex flex-col">
    <header class="bg-emerald-900 text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center">
        <h1 class="font-bold">ğŸ“– Ù…ØµØ­Ù Ø§Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ†</h1>
        <div class="flex gap-2">
            <button @click="view = 'index'" :class="{ 'tab-active': view === 'index' }" class="px-3 py-1 rounded-lg text-sm bg-emerald-800">Ø§Ù„Ù…ØµØ­Ù</button>
            <button @click="view = 'azkar'" :class="{ 'tab-active': view === 'azkar' }" class="px-3 py-1 rounded-lg text-sm bg-emerald-800">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
        </div>
    </header>

    <main class="flex-grow p-4 max-w-2xl mx-auto w-full">
        
        <div v-if="!isDownloaded && view === 'index'" class="bg-yellow-50 border-r-4 border-yellow-400 p-4 mb-6 rounded-xl shadow-sm">
            <p class="text-yellow-800 font-bold mb-2 text-sm">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø£ÙˆÙÙ„Ø§ÙŠÙ†).</p>
            <button @click="downloadFullQuran" :disabled="downloading" class="w-full bg-yellow-500 text-white font-bold py-2 rounded-lg hover:bg-yellow-600 transition">
                {{ downloading ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ' + progress + '%' : 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ­Ù ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª' }}
            </button>
        </div>

        <div v-if="view === 'index'">
            <input v-model="search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©..." class="w-full p-4 mb-4 border rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500 shadow-inner">
            <div class="grid gap-2">
                <div v-for="s in filteredSurahs" :key="s.number" @click="openSurah(s.number)" class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-emerald-600 cursor-pointer hover:bg-emerald-50 flex justify-between">
                    <span class="font-bold">{{ s.number }}. {{ s.name }}</span>
                    <span v-if="isDownloaded" class="text-emerald-600 text-xs">âœ… Ù…ØªÙˆÙØ±Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†</span>
                </div>
            </div>
        </div>

        <div v-if="view === 'reading' && selectedSurah" class="bg-white p-6 rounded-3xl shadow-lg border border-emerald-50">
            <h2 class="text-3xl font-bold text-center text-emerald-900 mb-6">{{ selectedSurah.name }}</h2>
            <div class="quran-font text-gray-800">
                <span v-for="ayah in selectedSurah.ayahs">
                    {{ ayah.text }} <span class="inline-block w-8 h-8 text-sm border border-emerald-200 rounded-full text-center leading-8 mx-1">{{ ayah.numberInSurah }}</span>
                </span>
            </div>
            <button @click="view = 'index'" class="w-full mt-8 py-3 bg-gray-100 rounded-xl font-bold text-gray-500">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙÙ‡Ø±Ø³</button>
        </div>

        <div v-if="view === 'azkar'" class="space-y-4">
            <h2 class="text-2xl font-bold text-emerald-900 mb-4">Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>
            <div v-for="z in fullAzkar" class="bg-white p-5 rounded-2xl shadow-sm border-r-4 border-emerald-500">
                <p class="text-lg leading-relaxed">{{ z.text }}</p>
                <div class="mt-4 text-xs font-bold text-emerald-600 italic">{{ z.repeat }} Ù…Ø±Ø§Øª</div>
            </div>
        </div>

    </main>
</div>

<script>
const { createApp, ref, onMounted, computed } = Vue;

createApp({
    setup() {
        const view = ref('index');
        const search = ref('');
        const downloading = ref(false);
        const progress = ref(0);
        const isDownloaded = ref(localStorage.getItem('quran_ready') === 'true');
        const allSurahsIndex = ref([]);
        const selectedSurah = ref(null);
        
        // Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙƒØ§Ù…Ù„Ø© (Ù†ØµÙˆØµ ÙˆØ§Ù‚Ø¹ÙŠØ©)
        const fullAzkar = ref([
            { text: 'Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒØŒ Ø±ÙØ¨ÙÙ‘ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø®ÙÙŠÙ’Ø±Ù Ù…ÙØ§ ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù ÙˆÙØ®ÙÙŠÙ’Ø±Ù Ù…ÙØ§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡ÙØŒ ÙˆÙØ£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù ÙˆÙØ´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡ÙØŒ Ø±ÙØ¨ÙÙ‘ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’ÙƒÙØ³ÙÙ„ÙØŒ ÙˆÙØ³ÙÙˆØ¡Ù Ø§Ù„Ù’ÙƒÙØ¨ÙØ±ÙØŒ Ø±ÙØ¨ÙÙ‘ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø¹ÙØ°ÙØ§Ø¨Ù ÙÙÙŠ Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù ÙˆÙØ¹ÙØ°ÙØ§Ø¨Ù ÙÙÙŠ Ø§Ù„Ù’Ù‚ÙØ¨Ù’Ø±Ù.', repeat: 1 },
            { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨ÙÙ‘ÙŠ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙØŒ Ø®ÙÙ„ÙÙ‚Ù’ØªÙÙ†ÙÙŠ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙØ¨Ù’Ø¯ÙÙƒÙØŒ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙÙ„ÙÙ‰ Ø¹ÙÙ‡Ù’Ø¯ÙÙƒÙ ÙˆÙÙˆÙØ¹Ù’Ø¯ÙÙƒÙ Ù…ÙØ§ Ø§Ø³Ù’ØªÙØ·ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ ØµÙÙ†ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¨ÙÙˆØ¡Ù Ù„ÙÙƒÙ Ø¨ÙÙ†ÙØ¹Ù’Ù…ÙØªÙÙƒÙ Ø¹ÙÙ„ÙÙŠÙÙ‘ØŒ ÙˆÙØ£ÙØ¨ÙÙˆØ¡Ù Ù„ÙÙƒÙ Ø¨ÙØ°ÙÙ†Ù’Ø¨ÙÙŠ ÙÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙ.', repeat: 1 }
        ]);

        onMounted(async () => {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ‡Ø±Ø³ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            allSurahsIndex.value = data.data;
        });

        const downloadFullQuran = async () => {
            downloading.value = true;
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ù…ØµØ­Ù ÙƒØ§Ù…Ù„Ø§Ù‹ (Ù†Øµ Ø¹Ø«Ù…Ø§Ù†ÙŠ) Ø¨Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¶Ø®Ù…
                const res = await fetch('https://api.alquran.cloud/v1/quran/quran-uthmani');
                const data = await res.json();
                
                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³ÙˆØ± ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù‡Ø§ØªÙ (localStorage)
                // Ù…Ù„Ø­ÙˆØ¸Ø©: localStorage Ù„Ù‡Ø§ Ø­Ø¯ 5MBØŒ Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù†ØµÙŠ Ø­ÙˆØ§Ù„ÙŠ 4MB
                localStorage.setItem('quran_data', JSON.stringify(data.data.surahs));
                localStorage.setItem('quran_ready', 'true');
                
                isDownloaded.value = true;
                alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ­Ù ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.");
            } catch (e) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            } finally {
                downloading.value = false;
            }
        };

        const openSurah = async (num) => {
            if (isDownloaded.value) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­Ù…Ù„Ø§Ù‹ØŒ Ù†Ù‚Ø±Ø£ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)
                const localData = JSON.parse(localStorage.getItem('quran_data'));
                selectedSurah.value = localData.find(s => s.number === num);
                view.value = 'reading';
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­Ù…Ù„ØŒ Ù†Ù‚Ø±Ø£ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/quran-uthmani`);
                const data = await res.json();
                selectedSurah.value = data.data;
                view.value = 'reading';
            }
            window.scrollTo(0,0);
        };

        const filteredSurahs = computed(() => allSurahsIndex.value.filter(s => s.name.includes(search.value)));

        return { view, search, downloading, progress, isDownloaded, allSurahsIndex, selectedSurah, fullAzkar, downloadFullQuran, openSurah, filteredSurahs };
    }
}).mount('#app');
</script>
</body>
</html>
